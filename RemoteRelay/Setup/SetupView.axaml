<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:setup="clr-namespace:RemoteRelay.Setup"
             x:Class="RemoteRelay.Setup.SetupView"
             x:DataType="setup:SetupViewModel">
    
    <UserControl.Styles>
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Margin" Value="0,15,0,8"/>
        </Style>
        <Style Selector="TextBlock.label">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>
        <Style Selector="Border.card">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,5"/>
        </Style>
        <Style Selector="Border.route-card">
            <Setter Property="Background" Value="#252526"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="15,5,0,5"/>
        </Style>
        <Style Selector="Button.test-btn">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="3,0"/>
            <Setter Property="MinWidth" Value="50"/>
        </Style>
        <Style Selector="Button.delete-btn">
            <Setter Property="Background" Value="#C42B1C"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,5"/>
        </Style>
        <Style Selector="NumericUpDown">
            <Setter Property="MinWidth" Value="110"/>
        </Style>
        <Style Selector="TextBox">
            <Setter Property="MinWidth" Value="120"/>
        </Style>
    </UserControl.Styles>

    <DockPanel Background="#1E1E1E">
        <!-- Header -->
        <Border DockPanel.Dock="Top" Background="#007ACC" Padding="15">
            <DockPanel>
                <Button Content="âœ• Close" 
                        DockPanel.Dock="Right" 
                        Command="{Binding CloseCommand}"
                        Background="Transparent"
                        Foreground="White"/>
                <TextBlock Text="Setup Configuration" 
                           FontSize="20" 
                           FontWeight="Bold" 
                           Foreground="White"/>
            </DockPanel>
        </Border>

        <!-- Footer with Save -->
        <Border DockPanel.Dock="Bottom" Background="#2D2D30" Padding="15">
            <DockPanel>
                <Button Content="ðŸ’¾ Save Configuration" 
                        DockPanel.Dock="Right"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding !IsSaving}"
                        Background="#0E639C"
                        Foreground="White"
                        Padding="20,10"/>
                <TextBlock Text="{Binding StatusMessage}" 
                           VerticalAlignment="Center"
                           Foreground="#CCCCCC"/>
            </DockPanel>
        </Border>

        <!-- Main Scrollable Content -->
        <ScrollViewer HorizontalScrollBarVisibility="Disabled" 
                      VerticalScrollBarVisibility="Auto"
                      Padding="20">
            <StackPanel Spacing="5">
                
                <!-- Server Settings Section -->
                <TextBlock Text="â•â•â• Server Settings â•â•â•" Classes="section-header"/>
                <Border Classes="card">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="15">
                            <TextBlock Text="Server Port:" Classes="label"/>
                            <NumericUpDown Value="{Binding ServerPort}" Minimum="1" Maximum="65535" Width="120"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="15">
                            <TextBlock Text="TCP Mirror:" Classes="label"/>
                            <TextBox Text="{Binding TcpMirrorAddress}" Watermark="Address" Width="250"/>
                            <TextBlock Text="Port:" Classes="label"/>
                            <NumericUpDown Value="{Binding TcpMirrorPort}" Minimum="1" Maximum="65535" Width="100"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Inactive Relay Section -->
                <TextBlock Text="â•â•â• Inactive Relay â•â•â•" Classes="section-header"/>
                <Border Classes="card">
                    <StackPanel Orientation="Horizontal" Spacing="15">
                        <TextBlock Text="Pin:" Classes="label"/>
                        <NumericUpDown Value="{Binding InactiveRelayPin}" Minimum="0" Maximum="40" Width="90"/>
                        <TextBlock Text="Inactive State:" Classes="label"/>
                        <ComboBox Width="100" SelectedIndex="0">
                            <ComboBoxItem Content="High" IsSelected="{Binding InactiveRelayState, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            <ComboBoxItem Content="Low"/>
                        </ComboBox>
                        <Button Content="Test ON" Command="{Binding TestInactiveRelayOnCommand}" Classes="test-btn"/>
                        <Button Content="Test OFF" Command="{Binding TestInactiveRelayOffCommand}" Classes="test-btn"/>
                    </StackPanel>
                </Border>

                <!-- Inputs & Routes Section -->
                <TextBlock Text="â•â•â• Inputs &amp; Routes â•â•â•" Classes="section-header"/>
                <Button Content="+ Add Input" 
                        Command="{Binding AddInputCommand}"
                        Background="#0E639C"
                        Foreground="White"
                        HorizontalAlignment="Left"
                        Padding="15,8"
                        Margin="0,0,0,10"/>

                <!-- Input Cards -->
                <ItemsControl ItemsSource="{Binding Inputs}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type setup:InputConfigViewModel}">
                            <Border Classes="card">
                                <StackPanel Spacing="12">
                                    <!-- Input Header -->
                                    <DockPanel>
                                        <Button Content="ðŸ—‘ Delete" 
                                                DockPanel.Dock="Right" 
                                                Command="{Binding DeleteInputCommand}"
                                                Classes="delete-btn"/>
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <TextBlock Text="Input Name:" Classes="label"/>
                                            <TextBox Text="{Binding SourceName}" Width="200"/>
                                        </StackPanel>
                                    </DockPanel>

                                    <!-- Physical Button Config -->
                                    <StackPanel Orientation="Horizontal" Spacing="15">
                                        <TextBlock Text="Physical Button Pin:" Classes="label"/>
                                        <NumericUpDown Value="{Binding PhysicalButtonPin}" Minimum="0" Maximum="40" Width="90"/>
                                        <TextBlock Text="Trigger:" Classes="label"/>
                                        <ComboBox Width="90" SelectedIndex="0">
                                            <ComboBoxItem Content="Low"/>
                                            <ComboBoxItem Content="High"/>
                                        </ComboBox>
                                        <Button Content="Test" Command="{Binding TestPhysicalButtonCommand}" Classes="test-btn"/>
                                    </StackPanel>

                                    <!-- Add Output Button -->
                                    <Button Content="+ Add Output" 
                                            Command="{Binding AddOutputRouteCommand}"
                                            Background="#3C3C3C"
                                            Foreground="White"
                                            Padding="10,5"
                                            HorizontalAlignment="Left"/>

                                    <!-- Output Routes -->
                                    <ItemsControl ItemsSource="{Binding OutputRoutes}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="{x:Type setup:RouteConfigViewModel}">
                                                <Border Classes="route-card">
                                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                                        <TextBlock Text="Name:" Classes="label"/>
                                                        <TextBox Text="{Binding OutputName}" Width="120"/>
                                                        
                                                        <TextBlock Text="Pin:" Classes="label"/>
                                                        <NumericUpDown Value="{Binding RelayPin}" Minimum="0" Maximum="40" Width="80"/>
                                                        
                                                        <CheckBox IsChecked="{Binding ActiveLow}" Content="Active Low" VerticalAlignment="Center" Margin="5,0"/>
                                                        <CheckBox IsChecked="{Binding IsDefaultRoute}" Content="Default" VerticalAlignment="Center" Margin="5,0"/>
                                                        
                                                        <ToggleSwitch IsChecked="{Binding IsRelayOn}" 
                                                                      OnContent="ON" 
                                                                      OffContent="OFF"
                                                                      VerticalAlignment="Center"
                                                                      Margin="10,0"/>
                                                        
                                                        <Button Content="ðŸ—‘" Command="{Binding DeleteRouteCommand}" Classes="delete-btn"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- General Options Section -->
                <TextBlock Text="â•â•â• General Options â•â•â•" Classes="section-header"/>
                <Border Classes="card">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="25">
                            <CheckBox IsChecked="{Binding FlashOnSelect}" Content="Flash On Select"/>
                            <CheckBox IsChecked="{Binding ShowIpOnScreen}" Content="Show IP On Screen"/>
                            <CheckBox IsChecked="{Binding Logging}" Content="Logging"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="Logo File:" Classes="label"/>
                            <TextBox Text="{Binding LogoFile}" Width="400"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>
